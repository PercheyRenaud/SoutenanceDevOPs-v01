---
# tasks file for wp.import_donnees.xml
  ###recupération des donnees.xml

- name: Import donnnees.xml
  command: "php {{ project_dir }}/MWC_01.00.00_install/maintenance/importDump.php --dbuser=WIKI_DB_USER --dbpass={{ mdp_bdd }} /appli/mediawiki/LIVR/28-05/INPUT/PACKAGE/Donnees.xml"
    #when: skip_donnees.rc > 0
  tags: importdata

- name : rebuildrecentchanges.php
  command: "php {{ project_dir }}/MWC_01.00.00_install/maintenance/rebuildrecentchanges.php"
  tags: importdata

### image #######################################""
# tasks file for wp.import_image
##########"recupération image"

#idemptotence check image
# - name: checking for pre-existing package_image
#   command: ls "{{ project_dir }}/MWC_01.00.00_install/images/DevOps.png"
#   register: skip_unpack_image
#   ignore_errors: true
#   changed_when: false
#   tags: image

- name: Extract dump_image.tar.gz > DevOps.png
  unarchive:
    src: "{{ livr_dir }}/INPUT/PACKAGE/dump_image.tar.gz"
    dest: "{{ livr_dir }}/INPUT/PACKAGE/"
    mode: 0755
    owner: wmcuser
    remote_src: yes
    creates: "{{ project_dir }}/MWC_01.00.00_install/images/2/21/DevOps.png"
  register: import_image
  # when: skip_unpack_image.rc > 0
  tags: importdata


- name : importImages.php
  command:
    cmd: "php {{ project_dir }}/MWC_01.00.00_install/maintenance/importImages.php --dbuser=WIKI_DB_USER --dbpass={{ mdp_bdd }} {{ livr_dir }}/INPUT/PACKAGE/images/"
  when: import_image is defined
  tags: importdata

- name : rebuildrecentchanges.php
  command: "php {{ project_dir }}/MWC_01.00.00_install/maintenance/rebuildrecentchanges.php"
  when: import_image is defined
  tags: importdata



  #################LoGo


  # tasks file for wp.import_logo
  ###LOGO

- name: Extract LoGo.tar.gz > GRC-135.png
  unarchive:
    src: "{{ livr_dir }}/INPUT/PACKAGE/LoGo.tar.gz"
    dest: "{{ project_dir }}/MWC_01.00.00_install/resources/assets"
    mode: 0755
    owner: wmcuser
    remote_src: yes
    creates: "{{ project_dir }}/MWC_01.00.00_install/ressources/assets/LoGo/GRC-135.png"
      # when: skip_unpack_image.rc > 0
  tags: importdata

- name: config setting.conf pour LOGO
  lineinfile:
    path: "{{ project_dir }}/MWC_01.00.00_install/LocalSettings.php"
    regexp: '1x'
    line: "$wgLogos = [ '1x' => \"$wgResourceBasePath/resources/assets/LoGo/GRC-135.png\" ];"
  tags: importdata
